# ============================================================
# YOLOv8-Segmentation Model with Lightweight Coordinate Attention
# ============================================================
#
# This configuration defines a YOLOv8-compatible segmentation model
# augmented with Coordinate Attention (CoordAtt) blocks.
#
# Purpose:
#   - Improve spatial feature encoding for elongated objects (ships)
#   - Preserve positional information with minimal computational overhead
#
# Requirements:
#   - Ultralytics YOLOv8
#   - Custom CoordAtt module must be installed and importable
#     (e.g., ultralytics.nn.modules.CoordAtt)
#
# Notes:
#   - CoordAtt blocks do NOT change tensor shapes
#   - Channel dimensions are inferred dynamically at runtime
#   - This YAML is compatible with YOLOv8-seg training pipelines
#
# ============================================================

# ------------------------------------------------------------
# Model metadata
# ------------------------------------------------------------
model: yolo                     # Model type identifier (YOLO family)
nc: 1                            # Number of classes (1 = Ship)

# ------------------------------------------------------------
# Backbone
# Feature extraction with CoordAtt-enhanced stages
# ------------------------------------------------------------
backbone:
  # Stage P1 / 2
  - [-1, 1, Conv, [64, 3, 2]]        # index 0 | Conv(c=64, k=3, s=2)

  # Stage P2 / 4
  - [-1, 1, Conv, [128, 3, 2]]       # index 1
  - [-1, 3, C2f, [128, True]]        # index 2 | CSP-style block
  - [-1, 1, CoordAtt, [128, 64]]     # index 3 | CoordAtt on P2
                                    # Args: [input_channels, reduction_channels]

  # Stage P3 / 8
  - [-1, 1, Conv, [256, 3, 2]]       # index 4
  - [-1, 6, C2f, [256, True]]        # index 5
  - [-1, 1, CoordAtt, [256, 64]]     # index 6 | CoordAtt on P3

  # Stage P4 / 16
  - [-1, 1, Conv, [512, 3, 2]]       # index 7
  - [-1, 6, C2f, [512, True]]        # index 8

  # Stage P5 / 32
  - [-1, 1, Conv, [1024, 3, 2]]      # index 9
  - [-1, 3, C2f, [1024, True]]       # index 10
  - [-1, 1, SPPF, [1024, 5]]         # index 11 | Spatial Pyramid Pooling (Fast)

# ------------------------------------------------------------
# Head
# Feature fusion + segmentation heads
# ------------------------------------------------------------
head:
  # P5 → P4 (upsampling and fusion)
  - [-1, 1, nn.Upsample, [None, 2, "nearest"]]   # index 12
  - [[-1, 8], 1, Concat, [1]]                    # index 13 | concat with P4
  - [-1, 3, C2f, [512]]                          # index 14 | P4 head

  # P4 → P3
  - [-1, 1, nn.Upsample, [None, 2, "nearest"]]   # index 15
  - [[-1, 6], 1, Concat, [1]]                    # index 16 | concat with P3
  - [-1, 3, C2f, [256]]                          # index 17 | P3 head (small scale)

  # P3 → P4
  - [-1, 1, Conv, [256, 3, 2]]                   # index 18 | downsample
  - [[-1, 14], 1, Concat, [1]]                   # index 19
  - [-1, 3, C2f, [512]]                          # index 20 | P4 head (medium)

  # P4 → P5
  - [-1, 1, Conv, [512, 3, 2]]                   # index 21 | downsample
  - [[-1, 11], 1, Concat, [1]]                   # index 22
  - [-1, 3, C2f, [1024]]                         # index 23 | P5 head (large)

  # ----------------------------------------------------------
  # Segmentation head
  # ----------------------------------------------------------
  - [[17, 20, 23], 1, Segment, [nc, 32, 256]]    # index 24
                                                    # Args:
                                                    #   nc   : number of classes
                                                    #   32   : number of mask prototypes
                                                    #   256  : mask resolution
